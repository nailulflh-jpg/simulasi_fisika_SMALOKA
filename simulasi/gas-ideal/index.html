<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Panci Presto - Gas Ideal dengan AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Gaya CSS tetap sama seperti sebelumnya */
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #fff;
            padding: 20px 0;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            color: #ffc107;
            transform: translateX(-5px);
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            margin: 0 auto;
            max-width: 1400px;
            color: #333;
        }
        
        .simulation-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        #cookerCanvas {
            border: 3px solid #495057;
            border-radius: 10px;
            background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 50%, #f0f0f0 100%);
            display: block;
            margin: 0 auto;
        }
        
        .control-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .equation-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .heat-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .heat-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 15px;
            border-radius: 10px;
            background: linear-gradient(to right, #3498db, #f39c12, #e74c3c);
            outline: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .heat-slider:hover {
            opacity: 1;
        }
        
        .heat-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .info-display {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            color: #333;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .gauge {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto;
        }
        
        .gauge-bg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #3498db, #f39c12, #e74c3c);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gauge-inner {
            width: 80%;
            height: 80%;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .warning-alert {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .btn-action {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .btn-warning:hover {
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }
        
        .collision-effect {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%);
            pointer-events: none;
            animation: collision-pulse 0.6s ease-out forwards;
        }
        
        @keyframes collision-pulse {
            0% {
                transform: scale(0.3);
                opacity: 1;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }
        
        .gas-info {
            background: #e8f4f8;
            border-left: 4px solid #667eea;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .momentum-display {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }
        
        .momentum-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        /* AI Assistant Styles */
        .ai-panel {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .ai-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .chat-container {
            background: #f8f9fa;
            border-radius: 10px;
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
        }
        
        .message {
            display: flex;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            position: relative;
        }
        
        .message.ai .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #e9ecef;
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .ai-input-container {
            display: flex;
            gap: 10px;
        }
        
        .ai-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .ai-input:focus {
            border-color: #3498db;
        }
        
        .ai-send-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .ai-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .ai-suggestion {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ai-suggestion:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 10px 15px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #666;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        .ai-insight {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #2c3e50;
        }
        
        /* Tambahkan kontrol suhu target */
        .target-temp-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .temp-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .temp-indicator {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        
        /* Kontrol pendinginan */
        .cooling-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .cooling-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        
        .cooling-indicator {
            background: rgba(52, 152, 219, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-link">&larr; Kembali ke Dashboard</a>
        
        <div class="main-container">
            <h1 class="text-center mb-4">
                <i class="fas fa-fire-alt me-3 text-danger"></i>Simulasi Panci Presto - Gas Ideal dengan AI
            </h1>
            
            <!-- Persamaan Gas Ideal -->
            <div class="equation-box">
                PV = nRT
                <div class="fs-6 mt-2 opacity-75">
                    P: Tekanan (atm) | V: Volume (L) | n: Jumlah Mol | R: 0.0821 L·atm/(mol·K) | T: Suhu (K)
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8">
                    <!-- Area Simulasi Visual -->
                    <div class="simulation-area">
                        <canvas id="cookerCanvas" width="700" height="500"></canvas>
                        <div id="collisionContainer"></div>
                    </div>
                    
                    <!-- Panel Informasi -->
                    <div class="info-display">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <h5>Suhu</h5>
                                <div class="gauge">
                                    <div class="gauge-bg">
                                        <div class="gauge-inner">
                                            <div id="tempValue">25</div>
                                            <div>°C</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <h5>Tekanan</h5>
                                <div class="gauge">
                                    <div class="gauge-bg">
                                        <div class="gauge-inner">
                                            <div id="pressureValue">1.0</div>
                                            <div>atm</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <h5>Volume</h5>
                                <div class="gauge">
                                    <div class="gauge-bg">
                                        <div class="gauge-inner">
                                            <div id="volumeValue">5.0</div>
                                            <div>L</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <h5>Jumlah Mol</h5>
                                <div class="gauge">
                                    <div class="gauge-bg">
                                        <div class="gauge-inner">
                                            <div id="molValue">0.2</div>
                                            <div>mol</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Display Momentum -->
                        <div class="momentum-display">
                            <h6><i class="fas fa-arrows-alt-h me-2"></i>Momentum Total Sistem</h6>
                            <div class="momentum-value" id="totalMomentum">0.00 × 10⁻²³ kg·m/s</div>
                            <small>Perubahan momentum per tumbukan: <span id="momentumChange">0.00</span> × 10⁻²³ kg·m/s</small>
                        </div>
                        
                        <!-- Informasi Gas Tambahan -->
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <div class="gas-info">
                                    <strong>Energi Kinetik Rata-rata:</strong> <span id="kineticInfo">6.21 × 10⁻²¹ J</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="gas-info">
                                    <strong>Kecepatan Rata-rata:</strong> <span id="velocityInfo">517 m/s</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="gas-info">
                                    <strong>Tumbukan/detik:</strong> <span id="collisionRate">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Panel Kontrol -->
                    <div class="control-panel">
                        <h4 class="mb-4">
                            <i class="fas fa-sliders-h me-2"></i>Kontrol Variabel Gas
                        </h4>
                        
                        <!-- Kontrol Suhu Target -->
                        <div class="target-temp-control">
                            <label class="form-label">
                                <i class="fas fa-thermometer-half me-2"></i>Suhu Target
                            </label>
                            <input type="range" class="heat-slider" id="targetTempSlider" min="25" max="150" value="100">
                            <div class="temp-display">
                                <span id="targetTempLevel" class="badge bg-light text-dark fs-6">100°C</span>
                                <span id="heatingStatus" class="temp-indicator">Menunggu</span>
                            </div>
                        </div>
                        
                        <!-- Kontrol Intensitas Api -->
                        <div class="heat-control">
                            <label class="form-label">
                                <i class="fas fa-fire me-2"></i>Intensitas Api (Pemanasan)
                            </label>
                            <input type="range" class="heat-slider" id="heatSlider" min="0" max="100" value="0">
                            <div class="text-center mt-2">
                                <span id="heatLevel" class="badge bg-light text-dark fs-6">0%</span>
                            </div>
                        </div>
                        
                        <!-- Kontrol Rate Pendinginan -->
                        <div class="cooling-control">
                            <label class="form-label">
                                <i class="fas fa-snowflake me-2"></i>Rate Pendinginan
                            </label>
                            <input type="range" class="heat-slider" id="coolingSlider" min="1" max="10" value="5">
                            <div class="cooling-info">
                                <span id="coolingLevel" class="badge bg-light text-dark fs-6">Sedang</span>
                                <span id="coolingRate" class="cooling-indicator">0.05°C/frame</span>
                            </div>
                        </div>
                        
                        <!-- Kontrol Volume -->
                        <div class="heat-control mt-3">
                            <label class="form-label">
                                <i class="fas fa-expand-arrows-alt me-2"></i>Volume Panci (V)
                            </label>
                            <input type="range" class="heat-slider" id="volumeSlider" min="2" max="10" step="0.5" value="5">
                            <div class="text-center mt-2">
                                <span id="volumeLevel" class="badge bg-light text-dark fs-6">5.0 L</span>
                            </div>
                        </div>
                        
                        <!-- Status Panci -->
                        <div class="mt-4">
                            <h5>Status Panci:</h5>
                            <div id="cookerStatus" class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>Sistem dalam keadaan stabil
                            </div>
                        </div>
                        
                        <!-- Peringatan -->
                        <div class="warning-alert" id="warningAlert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Peringatan!</strong> Tekanan melebihi batas aman!
                        </div>
                        
                        <!-- Tombol Aksi -->
                        <div class="mt-4 text-center">
                            <button class="btn-action" onclick="addGas()">
                                <i class="fas fa-plus me-2"></i>Tambah Gas
                            </button>
                            <button class="btn-action btn-warning" onclick="reduceGas()">
                                <i class="fas fa-minus me-2"></i>Kurangi Gas
                            </button>
                            <button class="btn-action btn-danger" onclick="emergencyStop()">
                                <i class="fas fa-power-off me-2"></i>Stop Darurat
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- AI Assistant Panel -->
            <div class="ai-panel">
                <div class="ai-header">
                    <div class="ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h5 class="mb-0">AI Assistant Fisika</h5>
                        <small class="opacity-75">Tanyakan apa saja tentang simulasi gas ideal!</small>
                    </div>
                </div>
                
                <div class="chat-container" id="chatContainer">
                    <div class="message ai">
                        <div class="message-bubble">
                            Halo! Saya AI Assistant untuk simulasi panci presto gas ideal. Saya bisa membantu Anda memahami konsep PV = nRT, menganalisis kondisi simulasi saat ini, atau menjawab pertanyaan tentang termodinamika. Apa yang ingin Anda ketahui?
                        </div>
                    </div>
                </div>
                
                <div class="ai-input-container">
                    <input type="text" class="ai-input" id="aiInput" placeholder="Ketik pertanyaan Anda di sini..." onkeypress="handleKeyPress(event)">
                    <button class="ai-send-btn" onclick="sendToAI()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <div class="ai-suggestions">
                    <div class="ai-suggestion" onclick="askQuestion('Analisis kondisi saat ini')">Analisis kondisi saat ini</div>
                    <div class="ai-suggestion" onclick="askQuestion('Mengapa tekanan meningkat?')">Mengapa tekanan meningkat?</div>
                    <div class="ai-suggestion" onclick="askQuestion('Apa itu hukum gas ideal?')">Apa itu hukum gas ideal?</div>
                    <div class="ai-suggestion" onclick="askQuestion('Hubungan suhu dan momentum')">Hubungan suhu dan momentum</div>
                    <div class="ai-suggestion" onclick="askQuestion('Berapa energi kinetik?')">Berapa energi kinetik?</div>
                    <div class="ai-suggestion" onclick="askQuestion('Aplikasi gas ideal di kehidupan sehari-hari')">Aplikasi gas ideal di kehidupan sehari-hari</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Konstanta fisika
        const R = 0.0821; // L·atm/(mol·K) - Konstanta gas universal
        const k_B = 1.380649e-23; // J/K - Konstanta Boltzmann
        const m_gas = 4.65e-26; // kg (massa molekul N2)
        
        // Variabel global untuk simulasi
        let heat = 0; // Intensitas pemanasan (0-100)
        let temperature = 25; // Suhu dalam Celsius
        let temperatureK = 298; // Suhu dalam Kelvin
        let targetTemperature = 100; // Suhu target dalam Celsius
        let pressure = 1.0; // Tekanan dalam atm
        let volume = 5.0; // Volume dalam Liter
        let n_mol = 0.2; // Jumlah mol gas
        let lidOffset = 0; // Posisi tutup panci
        let gasParticles = []; // Array untuk menyimpan partikel gas
        let time = 0; // Waktu simulasi
        let collisionCount = 0; // Jumlah tumbukan
        let collisionRate = 0; // Laju tumbukan per detik
        let lastCollisionTime = Date.now(); // Waktu terakhir untuk menghitung laju tumbukan
        let totalMomentum = 0; // Total momentum sistem
        let momentumChange = 0; // Perubahan momentum per tumbukan
        let heatingStatus = "Menunggu"; // Status pemanasan
        let coolingRate = 0.05; // Rate pendinginan dalam °C per frame (diperlambat)
        
        // Canvas setup untuk visualisasi
        const canvas = document.getElementById('cookerCanvas');
        const ctx = canvas.getContext('2d');
        
        // Class untuk partikel gas dengan hukum kekekalan momentum
        class GasParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                // Kecepatan awal berdasarkan suhu
                const speedFactor = Math.sqrt(temperatureK / 300);
                this.vx = (Math.random() - 0.5) * 4 * speedFactor;
                this.vy = (Math.random() - 0.5) * 4 * speedFactor;
                this.radius = 4;
                this.trail = []; // Jejak partikel
                this.maxTrailLength = 15;
                this.mass = m_gas; // Massa partikel
                this.collisionCooldown = 0; // Cooldown untuk mencegah tumbukan ganda
                this.fading = false; // Status untuk animasi penghapusan partikel
                this.opacity = 1; // Opasitas untuk efek fade out
            }
            
            update() {
                // Update collision cooldown
                if (this.collisionCooldown > 0) {
                    this.collisionCooldown--;
                }
                
                // Handle fading untuk partikel yang dihapus
                if (this.fading) {
                    this.opacity -= 0.05;
                    if (this.opacity <= 0) {
                        return false; // Hapus partikel
                    }
                }
                
                // Simpan jejak partikel
                this.trail.push({x: this.x, y: this.y, vx: this.vx, vy: this.vy});
                if (this.trail.length > this.maxTrailLength) {
                    this.trail.shift();
                }
                
                // Update posisi berdasarkan kecepatan
                this.x += this.vx;
                this.y += this.vy;
                
                // Cek tumbukan dengan dinding
                let collided = false;
                let wallNormal = {x: 0, y: 0};
                
                // Dinding kiri dan kanan
                if (this.x - this.radius <= 200 && this.collisionCooldown === 0) {
                    wallNormal = {x: 1, y: 0}; // Normal ke kanan
                    this.elasticCollision(wallNormal);
                    this.x = 200 + this.radius;
                    collided = true;
                } else if (this.x + this.radius >= 500 && this.collisionCooldown === 0) {
                    wallNormal = {x: -1, y: 0}; // Normal ke kiri
                    this.elasticCollision(wallNormal);
                    this.x = 500 - this.radius;
                    collided = true;
                }
                
                // Dinding atas dan bawah
                if (this.y - this.radius <= 150 && this.collisionCooldown === 0) {
                    wallNormal = {x: 0, y: 1}; // Normal ke bawah
                    this.elasticCollision(wallNormal);
                    this.y = 150 + this.radius;
                    collided = true;
                } else if (this.y + this.radius >= 350 && this.collisionCooldown === 0) {
                    wallNormal = {x: 0, y: -1}; // Normal ke atas
                    this.elasticCollision(wallNormal);
                    this.y = 350 - this.radius;
                    collided = true;
                }
                
                if (collided) {
                    collisionCount++;
                    this.collisionCooldown = 10; // Mencegah tumbukan ganda
                    this.createCollisionEffect(this.x, this.y);
                }
                
                return true; // Pertahankan partikel
            }
            
            // Tumbukan elastis dengan hukum kekekalan momentum
            elasticCollision(wallNormal) {
                // Momentum sebelum tumbukan
                const momentumBefore = {
                    x: this.mass * this.vx,
                    y: this.mass * this.vy
                };
                
                // Untuk tumbukan dengan dinding diam (massa tak terhingga)
                // Komponen kecepatan tegak lurus dinding berbalik
                // v' = v - 2(v·n)n
                
                const dotProduct = this.vx * wallNormal.x + this.vy * wallNormal.y;
                
                this.vx = this.vx - 2 * dotProduct * wallNormal.x;
                this.vy = this.vy - 2 * dotProduct * wallNormal.y;
                
                // Momentum setelah tumbukan
                const momentumAfter = {
                    x: this.mass * this.vx,
                    y: this.mass * this.vy
                };
                
                // Perubahan momentum
                const deltaMomentum = {
                    x: Math.abs(momentumAfter.x - momentumBefore.x),
                    y: Math.abs(momentumAfter.y - momentumBefore.y)
                };
                
                momentumChange = Math.sqrt(deltaMomentum.x * deltaMomentum.x + deltaMomentum.y * deltaMomentum.y);
            }
            
            // Efek visual saat tumbukan
            createCollisionEffect(x, y) {
                const effect = document.createElement('div');
                effect.className = 'collision-effect';
                effect.style.left = (x - 20) + 'px';
                effect.style.top = (y - 20) + 'px';
                document.getElementById('collisionContainer').appendChild(effect);
                
                setTimeout(() => {
                    effect.remove();
                }, 600);
            }
            
            // Gambar partikel dan jejaknya
            draw() {
                ctx.save();
                ctx.globalAlpha = this.opacity;
                
                // Gambar jejak partikel
                this.trail.forEach((point, index) => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, this.radius * (index / this.trail.length), 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(0, 255, 136, ${0.15 * (index / this.trail.length) * this.opacity})`;
                    ctx.fill();
                });
                
                // Gambar partikel utama
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                // Gradien untuk partikel
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius);
                gradient.addColorStop(0, '#00ff88');
                gradient.addColorStop(1, '#00cc66');
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Efek glow
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#00ff88';
                ctx.fill();
                ctx.shadowBlur = 0;
                
                // Tampilkan nilai momentum
                const momentum = this.mass * Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                if (momentum > 1e-25) {
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = '10px Arial';
                    ctx.fillText(`p: ${(momentum * 1e23).toFixed(1)}`, this.x + 10, this.y - 10);
                }
                
                ctx.restore();
            }
            
            // Dapatkan momentum partikel
            getMomentum() {
                return {
                    x: this.mass * this.vx,
                    y: this.mass * this.vy
                };
            }
            
            // Mulai animasi fade out
            startFading() {
                this.fading = true;
            }
        }
        
        // Inisialisasi partikel gas
        function initGasParticles() {
            gasParticles = [];
            const numParticles = Math.floor(n_mol * 40);
            for (let i = 0; i < numParticles; i++) {
                gasParticles.push(new GasParticle(
                    220 + Math.random() * 260,
                    170 + Math.random() * 160
                ));
            }
        }
        
        // Gambar kompor
        function drawStove() {
            const stoveY = canvas.height - 100;
            
            // Badan kompor
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(200, stoveY, 300, 80);
            
            // Kaki kompor
            ctx.fillStyle = '#34495e';
            ctx.fillRect(220, stoveY + 60, 20, 20);
            ctx.fillRect(460, stoveY + 60, 20, 20);
            
            // Api
            if (heat > 0) {
                const flameCount = Math.floor(heat / 20) + 1;
                for (let i = 0; i < flameCount; i++) {
                    const x = 250 + (i * 80);
                    const flameHeight = 30 + (heat / 2);
                    
                    // Api luar
                    ctx.beginPath();
                    ctx.moveTo(x, stoveY);
                    ctx.quadraticCurveTo(x - 20, stoveY - flameHeight, x, stoveY - flameHeight - 20);
                    ctx.quadraticCurveTo(x + 20, stoveY - flameHeight, x, stoveY);
                    ctx.fillStyle = `rgba(255, ${100 + heat}, 0, ${0.3 + heat/200})`;
                    ctx.fill();
                    
                    // Api dalam
                    ctx.beginPath();
                    ctx.moveTo(x, stoveY);
                    ctx.quadraticCurveTo(x - 10, stoveY - flameHeight * 0.7, x, stoveY - flameHeight * 0.9);
                    ctx.quadraticCurveTo(x + 10, stoveY - flameHeight * 0.7, x, stoveY);
                    ctx.fillStyle = `rgba(255, 255, ${100 + heat}, ${0.5 + heat/150})`;
                    ctx.fill();
                }
            }
        }
        
        // Gambar panci
        function drawPot() {
            const potX = 200;
            const potY = 150;
            const potWidth = 300;
            const potHeight = 200;
            
            // Badan panci
            ctx.fillStyle = '#95a5a6';
            ctx.fillRect(potX, potY, potWidth, potHeight);
            
            // Handle panci
            ctx.fillStyle = '#7f8c8d';
            ctx.fillRect(potX - 20, potY + 50, 20, 15);
            ctx.fillRect(potX + potWidth, potY + 50, 20, 15);
            
            // Area gas di dalam panci dengan gradien
            const gradient = ctx.createLinearGradient(potX, potY, potX, potY + potHeight);
            gradient.addColorStop(0, 'rgba(52, 152, 219, 0.1)');
            gradient.addColorStop(1, 'rgba(52, 152, 219, 0.3)');
            ctx.fillStyle = gradient;
            ctx.fillRect(potX + 10, potY + 20, potWidth - 20, potHeight - 30);
            
            // Gambar partikel gas
            gasParticles.forEach(particle => {
                particle.draw();
            });
            
            // Tutup panci
            const lidY = potY - 20 + lidOffset;
            ctx.fillStyle = '#bdc3c7';
            ctx.fillRect(potX - 10, lidY, potWidth + 20, 30);
            
            // Handle tutup
            ctx.fillStyle = '#95a5a6';
            ctx.fillRect(potX + potWidth/2 - 15, lidY - 10, 30, 20);
            
            // Katup tekanan
            ctx.beginPath();
            ctx.arc(potX + potWidth - 30, lidY + 15, 10, 0, Math.PI * 2);
            ctx.fillStyle = pressure > 2.5 ? '#e74c3c' : '#2ecc71';
            ctx.fill();
            
            // Indikator volume
            ctx.fillStyle = '#34495e';
            ctx.font = '14px Arial';
            ctx.fillText(`V = ${volume.toFixed(1)} L`, potX + 10, potY + potHeight + 20);
        }
        
        // Hitung total momentum sistem
        function calculateTotalMomentum() {
            let totalPx = 0;
            let totalPy = 0;
            
            gasParticles.forEach(particle => {
                const momentum = particle.getMomentum();
                totalPx += momentum.x;
                totalPy += momentum.y;
            });
            
            totalMomentum = Math.sqrt(totalPx * totalPx + totalPy * totalPy);
            return totalMomentum;
        }
        
        // Update simulasi berdasarkan persamaan gas ideal
        function updateSimulation() {
            // Konversi suhu ke Kelvin
            temperatureK = temperature + 273.15;
            
            // Logika pemanasan dengan suhu target
            if (heat > 0) {
                // Jika suhu kurang dari target, panaskan
                if (temperature < targetTemperature) {
                    // Rate pemanasan tergantung intensitas api dan selisih suhu
                    const tempDiff = targetTemperature - temperature;
                    const heatingRate = (heat / 100) * 2.0 * (1 + tempDiff / 50);
                    temperature += heatingRate;
                    heatingStatus = "Memanaskan";
                    
                    // Jika mendekati target, kurangi rate pemanasan
                    if (tempDiff < 5) {
                        temperature = Math.min(temperature, targetTemperature);
                    }
                } else {
                    // Jika suhu sudah mencapai target, matikan api secara otomatis
                    heat = 0;
                    document.getElementById('heatSlider').value = 0;
                    document.getElementById('heatLevel').textContent = '0%';
                    heatingStatus = "Suhu Tercapai";
                }
            } else {
                // Jika tidak ada panas, suhu akan turun perlahan dengan rate yang telah ditentukan
                if (temperature > 25) {
                    temperature -= coolingRate; // Menggunakan coolingRate yang telah dikonfigurasi
                    heatingStatus = "Mendingin";
                } else {
                    temperature = 25;
                    heatingStatus = "Menunggu";
                }
            }
            
            // Hitung tekanan menggunakan persamaan gas ideal: P = nRT/V
            pressure = (n_mol * R * temperatureK) / volume;
            
            // Update gerakan tutup berdasarkan tekanan
            lidOffset = Math.sin(time * 0.1) * (pressure - 1) * 3;
            
            // Update kecepatan partikel berdasarkan suhu
            const speedFactor = Math.sqrt(temperatureK / 300);
            gasParticles.forEach(particle => {
                const currentSpeed = Math.sqrt(particle.vx * particle.vx + particle.vy * particle.vy);
                const targetSpeed = 2 * speedFactor;
                const adjustment = targetSpeed / Math.max(currentSpeed, 0.1);
                
                particle.vx *= adjustment;
                particle.vy *= adjustment;
            });
            
            // Update partikel dan hapus yang sudah memudar
            gasParticles = gasParticles.filter(particle => particle.update());
            
            // Hitung total momentum
            calculateTotalMomentum();
            
            // Hitung laju tumbukan
            const currentTime = Date.now();
            const timeDiff = (currentTime - lastCollisionTime) / 1000; // detik
            if (timeDiff >= 1) {
                collisionRate = collisionCount / timeDiff;
                collisionCount = 0;
                lastCollisionTime = currentTime;
                document.getElementById('collisionRate').textContent = Math.round(collisionRate);
            }
            
            // Update display
            document.getElementById('tempValue').textContent = Math.round(temperature);
            document.getElementById('pressureValue').textContent = pressure.toFixed(2);
            document.getElementById('volumeValue').textContent = volume.toFixed(1);
            document.getElementById('molValue').textContent = n_mol.toFixed(2);
            
            // Update momentum display
            document.getElementById('totalMomentum').textContent = (totalMomentum * 1e23).toFixed(2) + ' × 10⁻²³ kg·m/s';
            document.getElementById('momentumChange').textContent = (momentumChange * 1e23).toFixed(2);
            
            // Hitung energi kinetik rata-rata
            const avgKE = 1.5 * k_B * temperatureK;
            document.getElementById('kineticInfo').textContent = (avgKE * 1e21).toFixed(2) + ' × 10⁻²¹ J';
            
            // Hitung kecepatan rata-rata
            const avgV = Math.sqrt(8 * k_B * temperatureK / (Math.PI * m_gas));
            document.getElementById('velocityInfo').textContent = avgV.toFixed(0) + ' m/s';
            
            // Update status pemanasan
            document.getElementById('heatingStatus').textContent = heatingStatus;
            
            // Update status
            updateStatus();
            
            time += 0.1;
        }
        
        // Update status sistem
        function updateStatus() {
            const statusDiv = document.getElementById('cookerStatus');
            const warningDiv = document.getElementById('warningAlert');
            
            if (pressure > 3.0) {
                statusDiv.className = 'alert alert-danger';
                statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Bahaya! Tekanan sangat tinggi!';
                warningDiv.style.display = 'block';
            } else if (pressure > 2.0) {
                statusDiv.className = 'alert alert-warning';
                statusDiv.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>Perhatian! Tekanan meningkat!';
                warningDiv.style.display = 'none';
            } else if (temperature > 100) {
                statusDiv.className = 'alert alert-info';
                statusDiv.innerHTML = '<i class="fas fa-thermometer-half me-2"></i>Suhu tinggi, momentum tinggi';
                warningDiv.style.display = 'none';
            } else {
                statusDiv.className = 'alert alert-success';
                statusDiv.innerHTML = '<i class="fas fa-check-circle me-2"></i>Sistem dalam keadaan stabil';
                warningDiv.style.display = 'none';
            }
        }
        
        // Animasi loop
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawStove();
            drawPot();
            
            updateSimulation();
            
            requestAnimationFrame(animate);
        }
        
        // Event listeners untuk kontrol
        document.getElementById('heatSlider').addEventListener('input', function(e) {
            heat = parseInt(e.target.value);
            document.getElementById('heatLevel').textContent = heat + '%';
        });
        
        document.getElementById('volumeSlider').addEventListener('input', function(e) {
            volume = parseFloat(e.target.value);
            document.getElementById('volumeLevel').textContent = volume.toFixed(1) + ' L';
        });
        
        // Event listener untuk suhu target
        document.getElementById('targetTempSlider').addEventListener('input', function(e) {
            targetTemperature = parseInt(e.target.value);
            document.getElementById('targetTempLevel').textContent = targetTemperature + '°C';
        });
        
        // Event listener untuk rate pendinginan
        document.getElementById('coolingSlider').addEventListener('input', function(e) {
            const coolingLevel = parseInt(e.target.value);
            // Mapping nilai slider (1-10) ke rate pendinginan (0.01 - 0.1)
            coolingRate = 0.01 + (coolingLevel - 1) * 0.01;
            
            // Update tampilan
            let coolingText = "Sangat Lambat";
            if (coolingLevel >= 8) coolingText = "Cepat";
            else if (coolingLevel >= 6) coolingText = "Sedang-Cepat";
            else if (coolingLevel >= 4) coolingText = "Sedang";
            else if (coolingLevel >= 2) coolingText = "Lambat";
            
            document.getElementById('coolingLevel').textContent = coolingText;
            document.getElementById('coolingRate').textContent = coolingRate.toFixed(3) + '°C/frame';
        });
        
        // Fungsi tambah gas
        function addGas() {
            n_mol = Math.min(n_mol + 0.1, 2.0);
            initGasParticles();
        }
        
        // Fungsi kurangi gas
        function reduceGas() {
            if (n_mol > 0.1) {
                n_mol = Math.max(n_mol - 0.1, 0.1);
                
                // Hapus beberapa partikel secara acak
                const particlesToRemove = Math.floor(gasParticles.length * 0.2);
                for (let i = 0; i < particlesToRemove; i++) {
                    const randomIndex = Math.floor(Math.random() * gasParticles.length);
                    if (gasParticles[randomIndex]) {
                        gasParticles[randomIndex].startFading();
                    }
                }
            }
        }
        
        // Fungsi stop darurat
        function emergencyStop() {
            heat = 0;
            document.getElementById('heatSlider').value = 0;
            document.getElementById('heatLevel').textContent = '0%';
        }
        
        // AI Assistant Functions
        const aiResponses = {
            'analisis kondisi saat ini': function() {
                const avgKE = 1.5 * k_B * temperatureK;
                const avgV = Math.sqrt(8 * k_B * temperatureK / (Math.PI * m_gas));
                
                let analysis = `📊 **Analisis Kondisi Simulasi Saat Ini:**\n\n`;
                analysis += `🌡️ **Suhu:** ${temperature.toFixed(1)}°C (${temperatureK.toFixed(1)} K)\n`;
                analysis += `🎯 **Suhu Target:** ${targetTemperature}°C\n`;
                analysis += `🔵 **Tekanan:** ${pressure.toFixed(2)} atm\n`;
                analysis += `📦 **Volume:** ${volume.toFixed(1)} L\n`;
                analysis += `⚗️ **Jumlah Mol:** ${n_mol.toFixed(2)} mol\n`;
                analysis += `🔥 **Status Pemanasan:** ${heatingStatus}\n`;
                analysis += `❄️ **Rate Pendinginan:** ${coolingRate.toFixed(3)}°C/frame\n\n`;
                
                if (pressure > 3.0) {
                    analysis += `⚠️ **Status:** KRITIS! Tekanan sangat tinggi. Segera kurangi panas atau tambahkan volume!\n`;
                } else if (pressure > 2.0) {
                    analysis += `⚠️ **Status:** WASPADA! Tekanan meningkat. Pertimbangkan untuk mengurangi panas.\n`;
                } else if (temperature > 100) {
                    analysis += `🔥 **Status:** Suhu tinggi. Partikel bergerak sangat cepat.\n`;
                } else {
                    analysis += `✅ **Status:** Sistem stabil. Kondisi ideal untuk simulasi.\n`;
                }
                
                analysis += `\n📈 **Detail Fisika:**\n`;
                analysis += `• Energi kinetik rata-rata: ${(avgKE * 1e21).toFixed(2)} × 10⁻²¹ J\n`;
                analysis += `• Kecepatan rata-rata partikel: ${avgV.toFixed(0)} m/s\n`;
                analysis += `• Laju tumbukan: ${Math.round(collisionRate)} tumbukan/detik\n`;
                analysis += `• Total momentum: ${(totalMomentum * 1e23).toFixed(2)} × 10⁻²³ kg·m/s\n\n`;
                
                analysis += `💡 **Rekomendasi:** ${getRecommendation()}`;
                
                return analysis;
            },
            
            'mengapa tekanan meningkat': function() {
                return `🔍 **Mengapa Tekanan Meningkat?**\n\n` +
                       `Tekanan gas dalam panci presto meningkat karena beberapa faktor:\n\n` +
                       `1. **Peningkatan Suhu (Hukum Gay-Lussac)**\n` +
                       `   • Saat Anda menambah panas, suhu gas meningkat\n` +
                       `   • Partikel gas bergerak lebih cepat\n` +
                       `   • Tumbukan dengan dinding lebih sering dan lebih kuat\n` +
                       `   • Secara matematis: P ∝ T (jika V dan n konstan)\n\n` +
                       `2. **Penurunan Volume (Hukum Boyle)**\n` +
                       `   • Jika volume berkurang, partikel terpaksa lebih dekat\n` +
                       `   • Frekuensi tumbukan dengan dinding meningkat\n` +
                       `   • Secara matematis: P ∝ 1/V (jika T dan n konstan)\n\n` +
                       `3. **Penambahan Jumlah Gas**\n` +
                       `   • Lebih banyak partikel = lebih banyak tumbukan\n` +
                       `   • Secara matematis: P ∝ n (jika V dan T konstan)\n\n` +
                       `Dalam persamaan PV = nRT, ketika T meningkat atau V menurun, P harus meningkat untuk menjaga kesetimbangan!`;
            },
            
            'apa itu hukum gas ideal': function() {
                return `📚 **Hukum Gas Ideal**\n\n` +
                       `Hukum gas ideal adalah persamaan keadaan yang menggambarkan perilaku gas hipotetis sempurna:\n\n` +
                       `**PV = nRT**\n\n` +
                       `Dimana:\n` +
                       `• **P** = Tekanan (atmosfer)\n` +
                       `• **V** = Volume (liter)\n` +
                       `• **n** = Jumlah mol gas\n` +
                       `• **R** = Konstanta gas universal (0.0821 L·atm/(mol·K))\n` +
                       `• **T** = Suhu mutlak (Kelvin)\n\n` +
                       `**Asumsi Gas Ideal:**\n` +
                       `1. Partikel gas tidak memiliki volume (titik massa)\n` +
                       `2. Tidak ada gaya interaksi antar partikel\n` +
                       `3. Tumbukan partikel dengan dinding bersifat elastis sempurna\n` +
                       `4. Gerakan partikel acak dan terus-menerus\n\n` +
                       `**Aplikasi Panci Presto:**\n` +
                       `Panci presto memanfaatkan prinsip ini - dengan menutup rapat, volume tetap, sehingga ketika suhu meningkat, tekanan meningkat drastis!`;
            },
            
            'hubungan suhu dan momentum': function() {
                return `🔄 **Hubungan Suhu dan Momentum**\n\n` +
                       `Suhu dan momentum memiliki hubungan langsung dalam teori kinetik gas:\n\n` +
                       `**1. Pada Level Molekuler:**\n` +
                       `• Suhu adalah ukuran energi kinetik rata-rata partikel\n` +
                       `• Momentum = massa × kecepatan (p = mv)\n` +
                       `• Energi kinetik = ½mv² = p²/(2m)\n\n` +
                       `**2. Hubungan Matematis:**\n` +
                       `• Energi kinetik rata-rata: KE_avg = (3/2)kT\n` +
                       `• Dimana k = konstanta Boltzmann (1.38 × 10⁻²³ J/K)\n` +
                       `• Jadi: (3/2)kT = (3/2)(p²)/(2m)\n` +
                       `• Hasilnya: p_rms = √(3mkT)\n\n` +
                       `**3. Dalam Simulasi Ini:**\n` +
                       `• Saat suhu meningkat, kecepatan partikel meningkat\n` +
                       `• Momentum setiap partikel meningkat\n` +
                       `• Total momentum sistem meningkat\n` +
                       `• Tumbukan dengan dinding lebih kuat (perubahan momentum lebih besar)\n\n` +
                       `**4. Konsekuensi Praktis:**\n` +
                       `Suhu tinggi = momentum tinggi = tekanan tinggi! Ini mengapa panci presto bisa sangat berbahaya jika tidak hati-hati.`;
            },
            
            'berapa energi kinetik': function() {
                const avgKE = 1.5 * k_B * temperatureK;
                const totalKE = avgKE * n_mol * 6.022e23; // Total energi kinetik semua molekul
                
                return `⚡ **Perhitungan Energi Kinetik**\n\n` +
                       `**1. Energi Kinetik Rata-rata per Molekul:**\n` +
                       `KE_avg = (3/2)kT\n` +
                       `= (3/2) × (1.38 × 10⁻²³ J/K) × ${temperatureK.toFixed(1)} K\n` +
                       `= ${(avgKE * 1e21).toFixed(2)} × 10⁻²¹ J\n\n` +
                       `**2. Total Energi Kinetik Sistem:**\n` +
                       `Total molekul = ${n_mol.toFixed(2)} mol × 6.022 × 10²³ mol⁻¹\n` +
                       `= ${(n_mol * 6.022e23).toExponential(2)} molekul\n\n` +
                       `Total KE = KE_avg × jumlah molekul\n` +
                       `= ${(avgKE * 1e21).toFixed(2)} × 10⁻²¹ J × ${(n_mol * 6.022e23).toExponential(2)}\n` +
                       `= ${(totalKE).toFixed(2)} J\n\n` +
                       `**3. Perspektif:**\n` +
                       `Energi ini setara dengan:\n` +
                       `• Mengangkat ${(totalKE / 9.8).toFixed(2)} kg setinggi 1 meter\n` +
                       `• Atau ${(totalKE / 3600000).toFixed(6)} kWh (sangat kecil untuk skala makro)\n\n` +
                       `**4. Hubungan dengan Tekanan:**\n` +
                       `Energi kinetik ini yang menyebabkan tekanan!\n` +
                       `Semakin tinggi KE, semakin sering dan kuat tumbukan dengan dinding.`;
            },
            
            'aplikasi gas ideal di kehidupan sehari-hari': function() {
                return `🏠 **Aplikasi Hukum Gas Ideal dalam Kehidupan Sehari-hari**\n\n` +
                       `Hukum gas ideal (PV = nRT) memiliki banyak aplikasi praktis di sekitar kita:\n\n` +
                       `**1. 🍳 DAPUR**\n` +
                       `• **Panci Presto**: Seperti dalam simulasi ini, panci presto menggunakan prinsip bahwa dengan volume tetap, peningkatan suhu akan meningkatkan tekanan. Ini memungkinkan air mendidih pada suhu lebih tinggi (>100°C), sehingga memasak lebih cepat!\n` +
                       `• **Pemanggang Roti**: Gas dalam oven memuai saat dipanaskan, menciptakan konveksi yang meratakan panas.\n\n` +
                       `**2. 🚗 TRANSPORTASI**\n` +
                       `• **Ban Mobil**: Tekanan ban berubah dengan suhu. Saat ban panas (setelah jarak jauh), tekanan udara di dalamnya meningkat. Itu sebabnya disarankan mengisi ban dalam keadaan dingin.\n` +
                       `• **Sistem AC**: Refrigeran dalam AC mengalami siklus kompresi dan ekspansi berdasarkan hukum gas untuk mentransfer panas.\n\n` +
                       `**3. ✈️ PENERBANGAN**\n` +
                       `• **Balon Udara Panas**: Udara di dalam balon dipanaskan sehingga volume memuai dan massa jenis berkurang, membuat balon terangkat.\n` +
                       `• **Sistem Tekanan Kabin**: Pesawat terbang pada ketinggian di mana tekanan udara sangat rendah, sehingga kabin harus ditekan untuk kenyamanan penumpang.\n\n` +
                       `**4. ⚽ OLAHRAGA & REKREASI**\n` +
                       `• **Bola Basket/Sepak**: Bola yang kurang angin akan lebih keras karena tekanan di dalamnya rendah. Saat dipompa, jumlah molekul udara (n) meningkat sehingga tekanan bertambah.\n` +
                       `• **Pelampung**: Pelampung mengapung karena volume udara di dalamnya besar, sehingga gaya angkat lebih besar dari berat pelampung.\n\n` +
                       `**5. 🏭 INDUSTRI**\n` +
                       `• **Tabung Gas**: Gas industri (oksigen, nitrogen, LPG) disimpan dalam tabung bertekanan tinggi. Volume kecil memungkinkan penyimpanan gas dalam jumlah besar.\n` +
                       `• **Proses Kimia**: Banyak reaksi kimia memerlukan kontrol suhu dan tekanan yang tepat berdasarkan hukum gas.\n\n` +
                       `**6. 🌡️ ALAT UKUR**\n` +
                       `• **Termometer Gas**: Beberapa termometer akurat menggunakan gas yang memuai saat suhu meningkat.\n` +
                       `• **Barometer**: Mengukur tekanan atmosfer yang berhubungan dengan massa jenis udara.\n\n` +
                       `**7. 🩺 MEDIS**\n` +
                       `• **Oksigen Medis**: Pasien dengan masalah pernapasan menerima oksigen bertekanan dari tabung.\n` +
                       `• **Anestesi**: Gas anestesi dikontrol secara hati-hati menggunakan prinsip gas ideal.\n\n` +
                       `**8. 🌍 LINGKUNGAN**\n` +
                       `• **Efek Rumah Kaca**: Gas-gas seperti CO₂ di atmosfer berperilaku mendekati gas ideal. Peningkatan jumlah gas ini meningkatkan kemampuan atmosfer menahan panas.\n` +
                       `• **Perubahan Cuaca**: Sistem tekanan tinggi dan rendah menentukan pola cuaca.\n\n` +
                       `Meskipun gas nyata tidak selalu mengikuti hukum gas ideal secara sempurna, hukum ini memberikan pendekatan yang sangat berguna untuk memahami dan memprediksi perilaku gas dalam banyak situasi praktis!`;
            }
        };
        
        function getRecommendation() {
            if (pressure > 3.0) {
                return "Segera kurangi panas atau tingkatkan volume untuk menurunkan tekanan!";
            } else if (pressure > 2.0) {
                return "Pertimbangkan untuk mengurangi panas secara bertahap.";
            } else if (temperature < 50) {
                return "Anda bisa meningkatkan panas untuk melihat efek yang lebih dramatis.";
            } else {
                return "Kondisi baik untuk eksperimen. Coba ubah parameter untuk melihat perubahannya!";
            }
        }
        
        function sendToAI() {
            const input = document.getElementById('aiInput');
            const question = input.value.trim();
            
            if (!question) return;
            
            // Add user message
            addMessage(question, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Process question
            setTimeout(() => {
                hideTypingIndicator();
                const response = getAIResponse(question);
                addMessage(response, 'ai');
            }, 1000);
        }
        
        function askQuestion(question) {
            document.getElementById('aiInput').value = question;
            sendToAI();
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendToAI();
            }
        }
        
        function getAIResponse(question) {
            const lowerQuestion = question.toLowerCase();
            
            // Check for exact matches
            for (const [key, responseFunc] of Object.entries(aiResponses)) {
                if (lowerQuestion.includes(key)) {
                    return responseFunc();
                }
            }
            
            // Check for keywords
            if (lowerQuestion.includes('suhu') && lowerQuestion.includes('tinggi')) {
                return `🌡️ **Tentang Suhu Tinggi:**\n\n` +
                       `Suhu tinggi dalam panci presto menyebabkan:\n\n` +
                       `1. **Partikel bergerak lebih cepat**\n` +
                       `   • Kecepatan rata-rata: ${Math.sqrt(8 * k_B * temperatureK / (Math.PI * m_gas)).toFixed(0)} m/s\n` +
                       `   • Energi kinetik meningkat\n\n` +
                       `2. **Tekanan meningkat**\n` +
                       `   • Lebih banyak tumbukan dengan dinding\n` +
                       `   • Setiap tumbukan lebih kuat\n\n` +
                       `3. **Bahaya potensial**\n` +
                       `   • Jika tekanan > 3 atm: SANGAT BERBAHAYA!\n` +
                       `   • Panci bisa meledak jika tidak dirancang dengan baik\n\n` +
                       `4. **Manfaat panci presto**\n` +
                       `   • Air mendidih pada suhu lebih tinggi\n` +
                       `   • Memasak lebih cepat\n` +
                       `   • Menghemat energi`;
            }
            
            if (lowerQuestion.includes('tekanan') && lowerQuestion.includes('rendah')) {
                return `🔵 **Tekanan Rendah:**\n\n` +
                       `Tekanan rendah dalam simulasi ini disebabkan oleh:\n\n` +
                       `1. **Suhu rendah**\n` +
                       `   • Partikel bergerak lamban\n` +
                       `   • Sedikit tumbukan dengan dinding\n\n` +
                       `2. **Volume besar**\n` +
                       `   • Partikel memiliki ruang lebih luas\n` +
                       `   - Frekuensi tumbukan berkurang\n\n` +
                       `3. **Jumlah gas sedikit**\n` +
                       `   • Lebih sedikit partikel = lebih sedikit tumbukan\n\n` +
                       `Untuk meningkatkan tekanan, coba:\n` +
                       `• Tambah panas (naikkan slider api)\n` +
                       `• Kurangi volume panci\n` +
                       `• Tambah jumlah gas`;
            }
            
            if (lowerQuestion.includes('momentum')) {
                return `📊 **Tentang Momentum:**\n\n` +
                       `Momentum adalah besaran fisika yang menggambarkan jumlah gerakan:\n\n` +
                       `**Definisi:**\n` +
                       `p = m × v\n` +
                       `Dimana:\n` +
                       `• p = momentum (kg·m/s)\n` +
                       `• m = massa (kg)\n` +
                       `• v = kecepatan (m/s)\n\n` +
                       `**Dalam Simulasi Ini:**\n` +
                       `• Massa setiap partikel: ${m_gas.toExponential(2)} kg\n` +
                       `• Total momentum sistem: ${(totalMomentum * 1e23).toFixed(2)} × 10⁻²³ kg·m/s\n` +
                       `• Perubahan momentum per tumbukan: ${(momentumChange * 1e23).toFixed(2)} × 10⁻²³ kg·m/s\n\n` +
                       `**Hukum Kekekalan Momentum:**\n` +
                       `Saat partikel menumbuk dinding, momentum berubah. Dinding memberikan gaya yang mengubah momentum partikel, dan partikel memberikan gaya sama besar ke dinding (Hukum Newton III).\n\n` +
                       `**Hubungan dengan Tekanan:**\n` +
                       `Tekanan adalah resultan dari semua gaya tumbukan per satuan luas!`;
            }
            
            // Default response
            return `💡 **Saya bisa membantu Anda dengan:**\n\n` +
                   `• Analisis kondisi simulasi saat ini\n` +
                   `• Penjelasan tentang hukum gas ideal (PV = nRT)\n` +
                   `• Hubungan suhu, tekanan, dan volume\n` +
                   `• Konsep momentum dan energi kinetik\n` +
                   `• Bahaya dan manfaat panci presto\n` +
                   `• Aplikasi gas ideal di kehidupan sehari-hari\n\n` +
                   `Coba tanyakan:\n` +
                   `• "Analisis kondisi saat ini"\n` +
                   `• "Mengapa tekanan meningkat?"\n` +
                   `• "Apa itu hukum gas ideal?"\n` +
                   `• "Hubungan suhu dan momentum"\n` +
                   `• "Berapa energi kinetik?"\n` +
                   `• "Aplikasi gas ideal di kehidupan sehari-hari?"`;
        }
        
        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = text.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(bubbleDiv);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            messageDiv.id = 'typingMessage';
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            
            bubbleDiv.appendChild(typingDiv);
            messageDiv.appendChild(bubbleDiv);
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function hideTypingIndicator() {
            const typingMessage = document.getElementById('typingMessage');
            if (typingMessage) {
                typingMessage.remove();
            }
        }
        
        // Inisialisasi
        initGasParticles();
        animate();
    </script>
</body>
</html>
